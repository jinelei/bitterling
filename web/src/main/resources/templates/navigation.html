<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="自留地"></title>
    <link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">
    <script th:src="@{/js/tailwind.min.js}"></script>
    <script th:src="@{/js/root.js}"></script>
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet">
    <link th:href="@{/css/root.css}" rel="stylesheet">
</head>

<body class="min-h-screen flex flex-col items-center justify-center">

    <main class="bg-page dark:bg-page-dark fixed top-0 left-0 w-screen h-screen overflow-hidden">

        <!-- 背景 -->
        <img id="imageBackgroud" th:src="@{/images/backgroud.jpg}"
            class="w-full h-full object-cover z-[-2] transition-transform duration-300 ease-in-out scale-100" alt="背景图">

        <div class="fixed top-10 w-full flex flex-col items-center justify-center ">
            <!-- 时间栏 -->
            <h1 id="time" class="cursor-default text-bold text-white text-[clamp(3rem,3.5rem,4rem)]">
            </h1>
            <h2 id="date" class="cursor-default text-bold text-white/50">
            </h2>
            <!-- 搜索栏 -->
            <form id="form" method="get" target="_blank" class="relative mt-10 w-100 w-[clamp(20rem,40vw,50rem)]">
                <!-- 搜索输入框 -->
                <input id="searchKeyword" type="text" placeholder="请输入搜索内容..."
                    class="w-full px-5 py-3 text-base text-gray-100 bg-black/50 hover:bg-black/70 backdrop-blur-md -webkit-backdrop-blur-md rounded-full shadow-sm outline-none">
                <!-- 搜索按钮 -->
                <button type="submit"
                    class="absolute right-1 top-1 bottom-1 w-10 rounded-full bg-primary text-white flex items-center justify-center hover:bg-primary/90 active:bg-primary/80 transition-all">
                    <i class="fa fa-search"></i>
                </button>
            </form>
        </div>

    </main>

    <div class="fixed bottom-8 flex items-center justify-center rounded-lg bg-black/30">
        <a th:href="@{/bookmark}"
            class="flex items-center justify-center bg-black/50 text-white rounded-lg m-2 p-3 text-[1rem] hover:scale-110 hover:text-red-500 transition-transform duration-300 ease-in-out scale-100">
            <i class="fa fa-book"></i>
        </a>
        <!-- <a href="#" id="theme"
            class="flex items-center justify-center bg-black/50 text-white rounded-lg m-2 p-3 text-[1rem]">
            <i id="theme-icon" th:class="'fa fa-moon-o'"></i>
        </a> -->
        <a th:each="bookmark : ${bookmarkByTags[__${tag?:'收藏'}__]}" th:href="${bookmark.url}" target="_blank"
            th:class="'flex items-center justify-center bg-black/50 text-white rounded-lg m-2 p-3 text-[1rem] hover:scale-110 transition-transform duration-300 ease-in-out scale-100 ' + ${'hover:text-' + bookmark.color + '-500'}"
            th:attr="data-category=${bookmark.parentId}" th:data-name="${bookmark.name}">
            <i th:class="'fa ' + ${bookmark.icon}"></i>
        </a>
        <a th:href="@{/about}"
            class="flex items-center justify-center bg-black/50 text-white rounded-lg m-2 p-3 text-[1rem] hover:scale-110 hover:text-red-500 transition-transform duration-300 ease-in-out scale-100">
            <i class="fa fa-plane"></i>
        </a>
    </div>

    <div class="fixed bottom-2 w-full flex items-center justify-center text-white/80">
        <th:block th:replace="~{layout/base :: footer}"></th:block>
    </div>

    <th:block>
        <script>
            let docTime = document.getElementById('time');
            let docDate = document.getElementById('date');
            function updateRealTime() {
                const now = new Date();
                const hours = now.getHours().toString().padStart(2, '0');
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const seconds = now.getSeconds().toString().padStart(2, '0');
                const timeStr = `${hours}:${minutes}:${seconds}`;
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                const day = now.getDate().toString().padStart(2, '0');
                const weekDays = ['星期日', '星期一', '星期二', '星期三', '星期四', '星期五', '星期六'];
                const weekDay = weekDays[now.getDay()];
                const dateStr = `${year}年${month}月${day}日 ${weekDay}`;
                docTime.textContent = timeStr;
                docDate.textContent = dateStr;
            }
            function initThemeSwitch() {
                const themeToggle = document.getElementById('theme');
                const themeIcon = document.getElementById('theme-icon');
                if (!!themeToggle) {
                    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                        document.documentElement.classList.add('dark');
                        themeIcon.classList.remove('fa-moon-o');
                        themeIcon.classList.add('fa-sun-o');
                    } else {
                        document.documentElement.classList.remove('dark');
                        themeIcon.classList.remove('fa-sun-o');
                        themeIcon.classList.add('fa-moon-o');
                    }
                    themeToggle.addEventListener('click', () => {
                        document.documentElement.classList.toggle('dark');
                        localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
                        if (localStorage.theme === 'dark') {
                            themeIcon.classList.remove('fa-moon-o');
                            themeIcon.classList.add('fa-sun-o');
                        } else {
                            themeIcon.classList.remove('fa-sun-o');
                            themeIcon.classList.add('fa-moon-o');
                        }
                    });
                }
            }
            function initSearchAction() {
                document.getElementById('form').addEventListener('submit', function (e) {
                    e.preventDefault();
                    const keyword = encodeURIComponent(document.getElementById('searchKeyword').value.trim());
                    const actionJson = JSON.stringify({
                        pluginId: "Send_Message",
                        payload: { text: decodeURIComponent(keyword) }
                    });
                    const encodedAction = encodeURIComponent(actionJson);
                    const doubaoUrl = `https://www.doubao.com/chat/url-action?action=${encodedAction}`;
                    window.open(doubaoUrl, '_blank');
                });
            }
            function initBackgroudScale() {
                let searchInput = document.getElementById("searchKeyword");
                let imageBackgroud = document.getElementById("imageBackgroud");
                searchInput.addEventListener('focus', function () {
                    imageBackgroud.classList.remove('scale-100');
                    imageBackgroud.classList.add('scale-110');
                })
                searchInput.addEventListener('blur', function () {
                    imageBackgroud.classList.add('scale-100');
                    imageBackgroud.classList.remove('scale-110');
                })
            }
            function copyDateTime() {
                docTime.addEventListener('click', async () => {
                    try {
                        const now = new Date();
                        const hours = now.getHours().toString().padStart(2, '0');
                        const minutes = now.getMinutes().toString().padStart(2, '0');
                        const seconds = now.getSeconds().toString().padStart(2, '0');
                        const timeStr = `${hours}:${minutes}:${seconds}`;
                        await navigator.clipboard.writeText(timeStr);
                    } catch (err) {
                        alert('复制失败，请手动复制！');
                    }
                });
                docDate.addEventListener('click', async () => {
                    try {
                        const now = new Date();
                        const hours = now.getHours().toString().padStart(2, '0');
                        const minutes = now.getMinutes().toString().padStart(2, '0');
                        const seconds = now.getSeconds().toString().padStart(2, '0');
                        const year = now.getFullYear();
                        const month = (now.getMonth() + 1).toString().padStart(2, '0');
                        const day = now.getDate().toString().padStart(2, '0');
                        const dateStr = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
                        await navigator.clipboard.writeText(dateStr);
                    } catch (err) {
                        alert('复制失败，请手动复制！');
                    }
                });
            }
            document.addEventListener('DOMContentLoaded', function () {
                updateRealTime();
                copyDateTime();
                setInterval(updateRealTime, 1000);
                initThemeSwitch();
                initBackgroudScale();
                initSearchAction();
            });
        </script>
    </th:block>

</body>

</html>