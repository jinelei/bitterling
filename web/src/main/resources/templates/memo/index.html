<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="备忘"></title>
    <link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">
    <script th:src="@{/js/tailwind.min.js}"></script>
    <script th:src="@{/js/root.js}"></script>
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet">
    <link th:href="@{/css/root.css}" rel="stylesheet">
</head>

<body class="min-h-screen flex flex-col items-center justify-center">

    <div class="w-full">
        <th:block th:replace="~{layout/base :: navbar('memo')}"></th:block>
    </div>

    <div class="flex flex-grow h-[calc(100vh-64px)] container lg:w-[70vw] w-[90vw]">
        <aside class="w-64 bg-white sidebar-shadow sticky top-0 flex flex-col hidden md:block">
            <div class="flex-grow overflow-y-auto p-4">
                <ul id="tagList" class="space-y-2">
                    <li th:each="tag : ${tagList}" class="border-b border-gray-200">
                        <a th:href="@{/memo(tagId=${tag.id})}"
                            th:class="'tag-btn w-full flex items-center justify-between p-3 hover:bg-gray-150 transition-all ' + ${currentTagId == tag.id ? 'bg-gray-100' : ''}">
                            <i th:class="'fa mr-2 ' + ${tag.icon}"></i>
                            <span th:text="${tag.title}"></span>
                            <span th:text="${tag.count}"
                                class="bg-primary/20 rounded-full w-6 h-6 flex items-center justify-center text-xs">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <main class="bg-white mx-auto py-6 p-3 flex-grow flex flex-col items-center">
            <div class="flex-grow w-full top-0">
                <ul id="memoList" class="space-y-2">
                    <li th:each="memo : ${memoList}" class="border-b border-gray-200">
                        <span class="flex-1 flex flex-row items-center hover:bg-gray-50 transition-all duration-300">
                            <a th:href="@{/memo/{id}(id=${memo.id})}"
                                class="tag-btn w-full flex flex-col items-start justify-between p-3 transition-all">
                                <span class="flex-1 flex flex-row">
                                    <span class="mr-4" th:text="${memo.title}"></span>
                                    <span class="text-gray-400" th:if="${memo.tags}" th:each="tag : ${memo.tags}">
                                        <span
                                            class="py-1 px-1 mr-2 bg-gray-400 hover:bg-gray-500 text-white text-xs rounded"
                                            th:text="${tag.title}"></span>
                                    </span>
                                </span>
                                <span th:text="${memo.subTitle}" class="text-gray-400 text-xs mt-1"></span>
                                <span class="text-gray-400 text-xs mt-1"
                                    th:text="${#temporals.format(memo.updateTime, 'yyyy-MM-dd HH:mm:ss')}"></span>
                            </a>
                            <a th:href="@{/memo/edit/{id}(id=${memo.id})}"
                                class="z-1000 bg-gray-100 hover:bg-primary/100 hover:text-white rounded-lg flex items-center justify-center text-center w-[3rem] h-[3rem] transition-all duration-300">
                                <i class="fa fa-edit"></i>
                            </a>
                            <a onclick="showDeleteModal(this)" th:data-value="${memo.id}" th:data-title="${memo.title}"
                                class="z-1000 bg-gray-100 hover:bg-primary/100 hover:text-white rounded-lg flex items-center justify-center text-center w-[3rem] h-[3rem] transition-all duration-300 ml-2">
                                <i class="fa fa-trash"></i>
                            </a>
                        </span>
                    </li>
                </ul>
            </div>

            <a th:href="@{/memo/create}"
                class="fixed bottom-6 right-6 w-14 h-14 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-lg hover:bg-blue-700 active:scale-95 transition-all duration-300 animate-bounce-slow z-50">
                <i class="fa fa-solid fa-plus text-xl"></i>
            </a>

            <div id="deleteModal" class="fixed inset-0 hidden items-center justify-center bg-black/50 z-50">
                <div class="w-full max-w-md p-6 bg-white rounded-lg shadow-lg">
                    <h3 class="text-lg font-semibold text-gray-800">确认删除</h3>
                    <p class="mt-2 text-gray-600" id="modalMessage">确定要删除这条记录吗？此操作不可撤销。</p>
                    <div class="mt-4 flex justify-end space-x-3">
                        <button onclick="hideDeleteModal()"
                            class="px-4 py-2 text-gray-700 bg-gray-200 rounded hover:bg-gray-300 transition-colors">
                            取消
                        </button>
                        <button onclick="confirmDelete()"
                            class="px-4 py-2 text-white bg-red-500 rounded hover:bg-red-600 transition-colors">
                            确认删除
                        </button>
                    </div>
                </div>
            </div>


            <th:block th:replace="~{layout/base :: footer}"></th:block>
        </main>
    </div>

    <th:block>
        <script>
            let currentRecordId = null;
            const modal = document.getElementById('deleteModal');
            const modalMessage = document.getElementById('modalMessage');

            function showDeleteModal(e) {
                console.log('element', e);
                currentRecordId = e.dataset.value;
                let currentRecordTitle = e.dataset.title;
                modalMessage.textContent = `确定要删除 ID 为 ${currentRecordTitle} 的记录吗？此操作不可撤销！`;
                modal.classList.remove('hidden');
                modal.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }

            function hideDeleteModal() {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                document.body.style.overflow = '';
                currentRecordId = null;
            }

            function confirmDelete() {
                if (currentRecordId) {
                    window.open("/memo/delete/" + currentRecordId, "_self");
                    hideDeleteModal();
                }
            }

            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    hideDeleteModal();
                }
            });
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    hideDeleteModal();
                }
            });
        </script>
    </th:block>

</body>

</html>