<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="备忘"></title>
    <link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">
    <script th:src="@{/js/tailwind.min.js}"></script>
    <script th:src="@{/js/root.js}"></script>
    <link th:href="@{/css/font-awesome.min.css}" rel="stylesheet">
    <link th:href="@{/css/root.css}" rel="stylesheet">
</head>

<body class="min-h-screen flex flex-col items-center justify-center">

    <div class="w-full">
        <th:block th:replace="~{layout/base :: navbar('memo')}"></th:block>
    </div>

    <div class="flex flex-grow h-[calc(100vh-64px)] container">
        <aside class="w-64 bg-white sidebar-shadow sticky top-0 flex flex-col hidden md:block">
            <div class="flex-grow overflow-y-auto p-4">
                <ul id="tagList" class="space-y-2">
                    <li th:each="tag : ${tagList}" class="border-b border-gray-200">
                        <a th:href="@{/memo(tagId=${tag.id})}"
                            th:class="'tag-btn w-full flex items-center justify-between p-3 hover:bg-gray-150 transition-all ' + ${currentTagId == tag.id ? 'bg-gray-100' : ''}">
                            <i th:class="'fa mr-2 ' + ${tag.icon}"></i>
                            <span th:text="${tag.title}"></span>
                            <span th:text="${tag.count}"
                                class="bg-primary/20 rounded-full w-6 h-6 flex items-center justify-center text-xs">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <main class="bg-white mx-auto py-6 p-3 flex-grow flex flex-col items-center">
            <div class="flex-grow w-full top-0">
                <ul id="memoList" class="space-y-2">
                    <li th:each="memo : ${memoList}" class="border-b border-gray-200">
                        <span class="flex-1 flex flex-row items-center hover:bg-gray-50">
                            <a th:href="@{/memo/{id}(id=${memo.id})}"
                                class="tag-btn w-full flex flex-col items-start justify-between p-3 transition-all">
                                <span class="flex-1 flex flex-row">
                                    <span class="mr-4" th:text="${memo.title}"></span>
                                    <span class="text-gray-400" th:if="${memo.tags}" th:each="tag : ${memo.tags}">
                                        <span
                                            class="py-1 px-1 mr-2 bg-gray-400 hover:bg-gray-500 text-white text-xs rounded"
                                            th:text="${tag.title}"></span>
                                    </span>
                                </span>
                                <span th:text="${memo.subTitle}" class="text-gray-400 text-xs mt-1"></span>
                                <span class="text-gray-400 text-xs mt-1"
                                    th:text="${#temporals.format(memo.updateTime, 'yyyy-MM-dd HH:mm:ss')}"></span>
                            </a>
                            <a th:href="@{/memo/edit/{id}(id=${memo.id})}" class="z-1000">
                                <span class="font-bold m-4 p-2 rounded-lg bg-gray-100"><i class="fa fa-edit"></i></span>
                            </a>
                            <a th:href="@{/memo/delete/{id}(id=${memo.id})}" class="z-1000">
                                <span class="font-bold m-4 p-2 rounded-lg bg-gray-100"><i
                                        class="fa fa-trash"></i></span>
                            </a>
                        </span>
                    </li>
                </ul>
            </div>

            <a th:href="@{/memo/create}"
                class="fixed bottom-6 right-6 w-14 h-14 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-lg hover:bg-blue-700 active:scale-95 transition-all duration-300 animate-bounce-slow z-50">
                <i class="fa fa-solid fa-plus text-xl"></i>
            </a>

            <th:block th:replace="~{layout/base :: footer}"></th:block>
        </main>
    </div>

    <th:block>
        <script>
            function mockMemo() {
                fetch('[[@{/memo/mock}]]', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                    },
                    body: JSON.stringify({
                        title: 'mockMemo'
                    })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`请求失败：${response.status} ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        // 处理成功返回的数据
                        console.log("接口返回结果：", data);
                        alert("调用成功！返回数据：" + JSON.stringify(data));
                    })
                    .catch(error => {
                        console.error("请求异常：", error);
                        alert("调用失败：" + error.message);
                    });
            }
        </script>
    </th:block>

</body>

</html>